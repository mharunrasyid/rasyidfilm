<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rasyid Film</title>
  <link rel="stylesheet" href="../stylesheets/style.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@500;600;700;800;900&display=swap"
    rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css" rel="stylesheet" />
</head>

<body data-theme="" class="body-playvideo">
  <div class="container" style="margin-bottom: 70px;">
    <header class="nav-container"
      style="box-shadow: rgba(50, 50, 93, 0.25) 0px 50px 100px -20px, rgba(0, 0, 0, 0.3) 0px 30px 60px -30px;">
      <div class="nav-logo">
        <i class="fas fa-bars nav-hamburger"></i>
        <a href="http://localhost:3000">
          <img src="../images/default-img/logo.png" alt="image" class="logo-img logo-img-play-video" />
          <img src="../images/default-img/small-logo.png" alt="image" class="small-logo-img" />
        </a>
      </div>
      <div class="nav-content nav-content-play-video">
        <form action="" class="form-search-video form-search-video-play seacrh-videos-padding-right">
          <input type="search" placeholder="Search" name="searchVideo" />
          <i class="fas fa-times close-search"></i>
        </form>
        <div class="search-btn">
          <i class="fas fa-search"></i>
        </div>
        <div class="nav-upload">
          <button class="login-btn" onclick="location.href='http://localhost:3000/login'">
            <i class="fas fa-sign-in-alt"></i>
            <span>Login</span>
          </button>
        </div>
      </div>
    </header>
    <main>
      <div class="sidebar-container sidebar-container-play-video">
        <a href="http://localhost:3000" class="sidebar-item-link">
          <i class="fas fa-home icon-item-link"></i>
          <span class="text-item-link">Home</span>
        </a>
        <div class="sidebar-theme">
          <i class="fas fa-sun icon-sidebar-theme light-theme-btn"></i>
          <i class="fas fa-moon icon-sidebar-theme dark-theme-btn"></i>
        </div>
      </div>
      <div class="overlay"></div>
      <div class="content-container content-container-play-video">
        <div class="container-video-play-video" style="padding-top: 10px;padding:0 15px;">
          <div class="sub-container-video-play-video"></div>
        </div>
      </div>
    </main>
  </div>
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
  window.addEventListener("load", () => {
    if (localStorage.getItem("theme") == "dark") {
      $('body').attr("data-theme", localStorage.getItem("theme"));
      $(".dark-theme-btn").addClass("icon-sidebar-theme-active");
      $(".light-theme-btn").removeClass("icon-sidebar-theme-active");
    } else {
      $('body').attr("data-theme", localStorage.getItem("theme"));
      $(".light-theme-btn").addClass("icon-sidebar-theme-active");
      $(".dark-theme-btn").removeClass("icon-sidebar-theme-active");
    }

    let queryUrl = window.location.href.split("/").pop()

    loadData(queryUrl);
  });

  const loadData = (queryUrl) => {
    if (localStorage.getItem("token")) {
      $(".form-search-video-play").removeClass("seacrh-videos-padding-right")

      $.ajax({
        url: 'http://localhost:3000/api/videos/studio',
        headers: {
          'Authorization': `Bearer ${localStorage.getItem("token")}`
        }
      }).done(function (data) {
        let {
          videos,
          userToken
        } = data;

        let navUploadCode = `<button class="btn-upload" onclick="location.href='http://localhost:3000/studio/add'">
                                        <i class="fas fa-plus" style="font-size: 12px;margin-right: 7px;"></i>
                                        <i class="fas fa-video"></i>
                                    </button>
                                    <div class="nav-user">
                                        <div class="profile-img-container">
                                        <img src="../images/default-img/profile-user.png" class="profile-user-img" alt="image" />
                                        <div class="dropdown-profile-container">
                                            <a href="http://localhost:3000/studio" class="dropdown-profile-container-link">
                                            <i class="fas fa-play-circle"></i>
                                            Rasyid Film Studio
                                            </a>
                                            <a href="http://localhost:3000/login" class="dropdown-profile-container-link dropdown-profile-container-link-signout">
                                            <i class="fas fa-sign-out-alt"></i>
                                            Sign Out
                                            </a>
                                        </div>
                                        </div>
                                        <a href="http://localhost:3000/channel/${userToken.userId}" class="nav-username-profile">${userToken.firstname.toUpperCase()} ${userToken.lastname.toUpperCase()}</a>
                                    </div>`;

        $(".nav-upload").html(navUploadCode);
        $(".sidebar-item-link-channel-sb").remove();

        let linkSidebarCode = `<a href="http://localhost:3000/channel/${userToken.userId}" class="sidebar-item-link sidebar-item-link-channel-sb">
                                <i class="fas fa-video icon-item-link"></i>
                                <span class="text-item-link">Your Channel</span>
                              </a>`;

        $(".sidebar-container a:first-child").after(linkSidebarCode);
      });
    }

    $.ajax({
      url: `http://localhost:3000/api/videos/watch/${queryUrl}`,
    }).done(function (data) {
      let options = {
        year: "numeric",
        month: "long",
        day: "numeric",
      };

      let {
        videos,
        video
      } = data;

      $(".video-play-video").remove();
      $(".header-sub-video-play-video-container").remove();
      $(".desc-sub-video-play-video-container").remove();

      let videoCode = `<video class="video-play-video" controls autoplay>
                        <source src="../video/${video.UrlVideo}">
                        Your browser does not support HTML video.
                      </video>
                      <div class="header-sub-video-play-video-container">
                        <div class="title">${video.title}</div>
                        <div class="info-play-video">
                          <span class="view-info">${video.views}</span> View &bull;
                          <span class="date-info">${new Date(video.createdAt).toLocaleString("id-ID", options)}</span>
                        </div>
                        <div class="btn-like-unlike-container">
                          <button class="btn-like-container button-like-container">
                            <i class="far fa-thumbs-up"></i>
                            <span class="angka-like">${video.likes}</span>
                          </button>
                          <button class="btn-like-container button-unlike-container">
                            <i class="far fa-thumbs-down"></i>
                            <span class="angka-like">0</span>
                          </button>
                        </div>
                      </div>
                      <div class="desc-sub-video-play-video-container">
                        <img src="../images/default-img/profile.png" alt="image" />
                        <div class="sub-desc-sub-video-play-video">
                          <div class="username-sub-desc-sub-video-play-video">
                            ${video.User.firstname.toUpperCase()} ${video.User.lastname.toUpperCase()} <i class="fas fa-check-circle" style="opacity: .5;"></i>
                          </div>
                          <div class="description-sub-desc-sub-video-play-video">
                            ${video.desc}
                          </div>
                          <div class="text-custom-height">MORE</div>
                        </div>
                      </div>`;

      $(".sub-container-video-play-video").append(videoCode);

      $(".text-custom-height").click(function () {
        if ($(this).text() == "MORE") {
          $(this).text("LESS");
          $(".description-sub-desc-sub-video-play-video").css({
            "max-height": "none"
          })
        } else {
          $(this).text("MORE");
          $(".description-sub-desc-sub-video-play-video").css({
            "max-height": "122px"
          })
        }
      })


      document.querySelector(".video-play-video").addEventListener("webkitfullscreenchange", function (e) {
        if (e.target.webkitDisplayingFullscreen) {
          document.querySelector(".video-play-video").style.objectFit = "contain";
        } else {
          document.querySelector(".video-play-video").style.objectFit = "cover";
        }
      });

      if (videos.length) {
        $(".container-video-random-play-video").remove();
        let videoRandomCode = '<div class="container-video-random-play-video">';
        for (let i = 0; i < videos.length; i++) {
          videoRandomCode += `<div class="sub-container-video-random-play-video" onclick="location.href='http://localhost:3000/watch/${videos[i].id}'">
                                <div class="video-container-play-video">
                                  <img src="../images/thumbnail/${videos[i].thumbnail}" alt="image" />
                                  <div class="video-duration-play-video">2.51</div>
                                </div>
                                <div class="text-video-user-container-play-video">
                                  <div class="title-video-play-video">${videos[i].title}</div>
                                  <a href="http://localhost:3000/channel/${videos[i].UserId}" class="username-video-play-video stopClick">${videos[i].User.firstname.toUpperCase()} ${videos[i].User.lastname.toUpperCase()}</a>
                                  <div class="username-video-play-video info-video-play-video">
                                    <span class="view-info">${videos[i].views}</span> views &bull;
                                    <span class="date-info">${new Date(videos[i].createdAt).toLocaleString("id-ID", options)}</span>
                                  </div>
                                </div>
                              </div>`;

        }
        videoRandomCode += '</div>';
        $(".container-video-play-video").append(videoRandomCode);

        $(".stopClick").click(function (e) {
          e.stopPropagation();
        });
      } else {
        $(".sub-container-video-play-video").css({
          "width": "100%",
        })
        $(".container-video-play-video").css({
          "width": "100%"
        })
        $(".video-play-video").css({
          "height": "45vw",
          "maxHeight": "550px"
        })
        $(".content-container-play-video").css({
          "maxWidth": "1200px",
          "marginLeft": "auto !important",
          "marginRight": "auto !important",
        })

        $(".content-container-play-video").addClass("content-container-play-video-auto");
      }

      $.ajax({
        url: `http://localhost:3000/api/comments/${queryUrl}`,
      }).done(function (data) {
        $(".comment-sub-video-play-video-container").remove();

        let commentsCode = `<div class="comment-sub-video-play-video-container">
                              <div class="total-comment-play-video">
                                <span>${data.length}</span> Comments
                              </div>
                              <form action="" class="add-comment-container">
                                <img src="../images/default-img/profile.png" alt="image" />
                                <div class="input-comment-container">
                                  <input type="text" name="inputAdd" id="inputAdd" placeholder="Write a public comment..." />
                                  <div class="btn-container-input-comment-container">
                                    <button type="button" class="btn-cancel-add-comment">Cancel</button>
                                    <button class="btn-add-comment">Comment</button>
                                  </div>
                                </div>
                              </form>
                              <div class="comments-container">`;

        for (let i = 0; i < data.length; i++) {
          commentsCode += `<div class="sub-comments-container">
                            <a href="http://localhost:3000/channel/${data[i].User.id}">
                              <img src="../images/default-img/profile.png" alt="image" />
                            </a>
                            <div class="text-sub-comments-container">
                              <a href="http://localhost:3000/channel/${data[i].User.id}" class="username-comment">${data[i].User.firstname.toUpperCase()} ${data[i].User.lastname.toUpperCase()}</a>
                              <span>7 Oktober 2021</span>
                              <div class="desc-comment">${data[i].desc}</div>
                            </div>
                            <i class="fas fa-trash-alt delete-comment"></i>
                          </div>`;
        }

        commentsCode += `</div></div>`
        $(".sub-container-video-play-video").append(commentsCode);

        $(".input-comment-container input").focus(function () {
          $(this).addClass("input-add-comment-active");
        });

        $(".input-comment-container input").blur(function () {
          $(this).removeClass("input-add-comment-active");
        });

        $(".button-like-container").click(function () {
          if ($(this).children("i").hasClass("fas")) {
            $(this).children("i").attr('class', 'far fa-thumbs-up');
          } else {
            $(this).children("i").attr('class', 'fas fa-thumbs-up');
          }
          $(".button-unlike-container").children("i").attr('class', 'far fa-thumbs-down');
        })

        $(".button-unlike-container").click(function () {
          if ($(this).children("i").hasClass("fas")) {
            $(this).children("i").attr('class', 'far fa-thumbs-down');
          } else {
            $(this).children("i").attr('class', 'fas fa-thumbs-down');
          }
          $(".button-like-container").children("i").attr('class', 'far fa-thumbs-up');
        })

        $(".btn-cancel-add-comment").click(function () {
          $(".input-comment-container input").val("");
        })
      })

    });
  };

  const searchData = (queryUrl) => {
    $.ajax({
      url: `http://localhost:3000/api/videos${queryUrl ? queryUrl : ""}`
    }).done(function (data) {
      window.location.href = `http://localhost:3000${queryUrl ? queryUrl : ""}`;
    }).fail(function (err) {
      window.location.href = `http://localhost:3000${queryUrl ? queryUrl : ""}`;
    });
  };

  $(".form-search-video-play").submit(function (event) {
    event.preventDefault();

    let inputSearch = $(".form-search-video-play input").val();
    urlSearch = `?searchName=${inputSearch}`;
    searchData(urlSearch);
  })

  $(document).ready(function () {
    $('.nav-hamburger').click(function () {
      if ($(".sidebar-container").css('width') == '255px') {
        if (window.matchMedia('(max-width: 400px)').matches) {
          $('.sidebar-container').animate({
            width: "0"
          });
        } else {
          $('.sidebar-container').animate({
            width: "0px"
          });

          $('.sidebar-container-play-video').animate({
            width: "0px"
          });
        }

        $('.sidebar-item-link').animate({
          paddingLeft: "13px"
        });

        $('.content-container').animate({
          marginLeft: "0px"
        });

        $('.sidebar-theme').css({
          "visibility": "hidden"
        });

        $(".overlay").removeClass("overlay-show-play-video");
        $(".nav-content").removeClass("hide-all");
        $(".small-logo-img").removeClass("small-logo-img-block");
      } else {
        $('.sidebar-container').animate({
          width: "255px"
        });
        $('.sidebar-item-link').animate({
          paddingLeft: "20px"
        });
        $('.content-container').animate({
          marginLeft: "255px"
        });
        $('.sidebar-theme').css({
          "visibility": "visible"
        });
        $(".overlay").addClass("overlay-show-play-video");
        $(".nav-content").addClass("hide-all");
        $(".small-logo-img").addClass("small-logo-img-block");
      }
    })
  })

  $(".search-btn").on("click", function () {
    $(".form-search-video").addClass("form-search-video-fixed");
    $(".close-search").addClass("close-search-fixed");
    $(".form-search-video input").addClass("input-fixed");
    $(".sidebar-container").css({
      "z-index": "-1"
    });
    $('.sidebar-container').css({
      "width": "0px"
    });
    $('.sidebar-item-link').css({
      "paddingLeft": "13px"
    });
    $('.sidebar-theme').css({
      "visibility": "hidden"
    });

  })

  $(".close-search").on("click", function () {
    $(".form-search-video").removeClass("form-search-video-fixed");
    $(".close-search").removeClass("close-search-fixed");
    $(".form-search-video input").removeClass("input-fixed");
    $(".sidebar-container").css({
      "z-index": "1000"
    });
  })

  $('.form-search-video input').keyup(function (e) {
    if (e.keyCode == 13) {
      $(".form-search-video").removeClass("form-search-video-fixed");
      $(".close-search").removeClass("close-search-fixed");
      $(".form-search-video input").removeClass("input-fixed");
      $(".sidebar-container").css({
        "z-index": "1000",
      });
    }
  });

  $(".overlay").on("click", function () {
    if (window.matchMedia('(max-width: 400px)').matches) {
      $('.sidebar-container').animate({
        width: "0"
      });
    } else {
      $('.sidebar-container').animate({
        width: "0px"
      });

      $('.sidebar-container-play-video').animate({
        width: "0px"
      });
    }
    $('.sidebar-item-link').animate({
      paddingLeft: "13px"
    });
    $('.content-container').animate({
      marginLeft: "0px"
    });
    $('.sidebar-theme').css({
      "visibility": "hidden"
    });
    $(".overlay").removeClass("overlay-show-play-video");
    $(".nav-content").removeClass("hide-all");
    $(".small-logo-img").removeClass("small-logo-img-block");
  })

  $(".light-theme-btn").click(function () {
    localStorage.setItem("theme", "light");
    $('body').attr("data-theme", localStorage.getItem("theme"));
    $(".light-theme-btn").addClass("icon-sidebar-theme-active");
    $(".dark-theme-btn").removeClass("icon-sidebar-theme-active");
  });

  $(".dark-theme-btn").click(function () {
    localStorage.setItem("theme", "dark");
    $('body').attr("data-theme", localStorage.getItem("theme"));
    $(".dark-theme-btn").addClass("icon-sidebar-theme-active");
    $(".light-theme-btn").removeClass("icon-sidebar-theme-active");
  });


  $(document).click(function (event) {
    if (
      event.target.className != "profile-user-img" &&
      event.target.className != "dropdown-profile-container-link"
    ) {
      $(".dropdown-profile-container").css({
        visibility: "hidden",
      });
    } else {
      $(".dropdown-profile-container").css({
        visibility: "visible",
      });
    }
  });

  $(".nav-upload").on("click",
    ".nav-user .profile-img-container .dropdown-profile-container .dropdown-profile-container-link-signout",
    function () {
      localStorage.removeItem("token")
    })
</script>

</html>